# Azure Container Instances - CI/CD Pipeline
# ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼ã¨ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã—ã¾ã™

name: ACI Deployment Pipeline

on:
  push:
    branches: [ main, develop ]
    paths:
      - 'templates/**'
      - '.github/workflows/**'
  pull_request:
    branches: [ main ]
    paths:
      - 'templates/**'
  workflow_dispatch:
    inputs:
      environment:
        description: 'ãƒ‡ãƒ—ãƒ­ã‚¤ç’°å¢ƒ'
        required: true
        default: 'development'
        type: choice
        options:
        - development
        - staging
        - production
      template_type:
        description: 'ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¿ã‚¤ãƒ—'
        required: true
        default: 'aci-simple'
        type: choice
        options:
        - aci-simple
        - aci-with-volumes

env:
  AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
  AZURE_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
  AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
  AZURE_CLIENT_SECRET: ${{ secrets.AZURE_CLIENT_SECRET }}

jobs:
  # Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼
  validate:
    name: ğŸ” Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ¤œè¨¼
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: ğŸ” Azure ãƒ­ã‚°ã‚¤ãƒ³
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
        
    - name: ğŸ§ª Bicep ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
      run: |
        echo "ğŸ” Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ§‹æ–‡ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™..."
        
        # ã‚·ãƒ³ãƒ—ãƒ« ACI ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼
        echo "ğŸ“‹ aci-simple ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¤œè¨¼ä¸­..."
        az bicep build --file ./templates/aci-simple/main.bicep --outfile ./templates/aci-simple/main.json
        
        # ãƒœãƒªãƒ¥ãƒ¼ãƒ ä»˜ã ACI ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ¤œè¨¼
        echo "ğŸ“‹ aci-with-volumes ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ¤œè¨¼ä¸­..."
        az bicep build --file ./templates/aci-with-volumes/main.bicep --outfile ./templates/aci-with-volumes/main.json
        
        echo "âœ… ã™ã¹ã¦ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ãŒå®Œäº†ã—ã¾ã—ãŸ"
        
    - name: ğŸ¯ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ What-If åˆ†æ
      run: |
        echo "ğŸ”® What-If åˆ†æã‚’å®Ÿè¡Œä¸­..."
        
        # ãƒ†ã‚¹ãƒˆç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆ
        TEST_RG="rg-aci-test-$(date +%s)"
        echo "ğŸ“‚ ãƒ†ã‚¹ãƒˆç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ: $TEST_RG"
        az group create --name "$TEST_RG" --location "japaneast"
        
        # ã‚·ãƒ³ãƒ—ãƒ« ACI ã® What-If
        echo "ğŸ” aci-simple ã® What-If åˆ†æ..."
        az deployment group what-if \
          --resource-group "$TEST_RG" \
          --template-file ./templates/aci-simple/main.bicep \
          --parameters ./templates/aci-simple/main.parameters.json \
          --parameters containerGroupName="test-aci-simple"
          
        # ãƒœãƒªãƒ¥ãƒ¼ãƒ ä»˜ã ACI ã® What-If
        echo "ğŸ” aci-with-volumes ã® What-If åˆ†æ..."
        az deployment group what-if \
          --resource-group "$TEST_RG" \
          --template-file ./templates/aci-with-volumes/main.bicep \
          --parameters ./templates/aci-with-volumes/main.parameters.json \
          --parameters containerGroupName="test-aci-volumes"
          
        # ãƒ†ã‚¹ãƒˆç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®å‰Šé™¤
        echo "ğŸ§¹ ãƒ†ã‚¹ãƒˆç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤: $TEST_RG"
        az group delete --name "$TEST_RG" --yes --no-wait
        
    - name: ğŸ“Š ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
      uses: actions/upload-artifact@v4
      with:
        name: bicep-templates
        path: |
          ./templates/
          ./catalog.yaml
          ./environment-definition.yaml
        retention-days: 30

  # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»å“è³ªãƒã‚§ãƒƒã‚¯
  security-scan:
    name: ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
    runs-on: ubuntu-latest
    needs: validate
    
    steps:
    - name: ğŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: ğŸ›¡ï¸ Bicep ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³
      run: |
        echo "ğŸ” Bicep ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œä¸­..."
        
        # PSRule for Azure ã‚’ä½¿ç”¨ã—ãŸã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
        npm install -g @microsoft/azure-rules
        
        # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®å®Ÿè¡Œ
        echo "ğŸ“‹ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’é©ç”¨ä¸­..."
        
        # ã‚«ã‚¹ã‚¿ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯
        echo "ğŸ” ã‚«ã‚¹ã‚¿ãƒ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."
        
        # æ©Ÿå¯†æƒ…å ±ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯
        if grep -r "password\|secret\|key" ./templates/ --include="*.bicep" --include="*.json"; then
          echo "âš ï¸ æ©Ÿå¯†æƒ…å ±ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™"
          exit 1
        else
          echo "âœ… æ©Ÿå¯†æƒ…å ±ã®ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯æ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ"
        fi
        
        # ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã®ãƒã‚§ãƒƒã‚¯
        if grep -r "\"type\": \"Public\"" ./templates/ --include="*.bicep" --include="*.json"; then
          echo "âš ï¸ ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼ˆé–‹ç™ºç’°å¢ƒã§ã¯å•é¡Œã‚ã‚Šã¾ã›ã‚“ãŒã€æœ¬ç•ªç’°å¢ƒã§ã¯ç¢ºèªã—ã¦ãã ã•ã„ï¼‰"
        fi
        
        echo "âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ãŒå®Œäº†ã—ã¾ã—ãŸ"

  # é–‹ç™ºç’°å¢ƒã¸ã®è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
  deploy-dev:
    name: ğŸš€ é–‹ç™ºç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
    runs-on: ubuntu-latest
    needs: [validate, security-scan]
    if: github.ref == 'refs/heads/develop' || github.event_name == 'workflow_dispatch'
    environment: development
    
    steps:
    - name: ğŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: ğŸ” Azure ãƒ­ã‚°ã‚¤ãƒ³
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
        
    - name: ğŸ“‚ ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
      run: |
        RG_NAME="rg-aci-dev-${{ github.run_number }}"
        echo "RESOURCE_GROUP=$RG_NAME" >> $GITHUB_ENV
        
        echo "ğŸ“‚ é–‹ç™ºç’°å¢ƒç”¨ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ: $RG_NAME"
        az group create --name "$RG_NAME" --location "japaneast"
        
    - name: ğŸ¯ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‡ãƒ—ãƒ­ã‚¤
      run: |
        TEMPLATE_TYPE="${{ github.event.inputs.template_type || 'aci-simple' }}"
        CONTAINER_NAME="aci-dev-${{ github.run_number }}"
        
        echo "ğŸš€ $TEMPLATE_TYPE ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­..."
        
        az deployment group create \
          --resource-group "$RESOURCE_GROUP" \
          --name "aci-deployment-${{ github.run_number }}" \
          --template-file "./templates/$TEMPLATE_TYPE/main.bicep" \
          --parameters "./templates/$TEMPLATE_TYPE/main.parameters.json" \
          --parameters containerGroupName="$CONTAINER_NAME" environmentName="development"
          
    - name: ğŸ“Š ãƒ‡ãƒ—ãƒ­ã‚¤çµæœã®å–å¾—
      run: |
        echo "ğŸ“Š ãƒ‡ãƒ—ãƒ­ã‚¤çµæœã‚’å–å¾—ä¸­..."
        
        DEPLOYMENT_NAME="aci-deployment-${{ github.run_number }}"
        
        # ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã®å–å¾—
        FQDN=$(az deployment group show --resource-group "$RESOURCE_GROUP" --name "$DEPLOYMENT_NAME" --query properties.outputs.fqdn.value -o tsv)
        URL=$(az deployment group show --resource-group "$RESOURCE_GROUP" --name "$DEPLOYMENT_NAME" --query properties.outputs.url.value -o tsv)
        
        echo "ğŸŒ FQDN: $FQDN"
        echo "ğŸ”— URL: $URL"
        
        # GitHub Environment ã«å¤‰æ•°ã‚’è¨­å®š
        echo "DEPLOYMENT_URL=$URL" >> $GITHUB_ENV
        echo "DEPLOYMENT_FQDN=$FQDN" >> $GITHUB_ENV
        
    - name: ğŸ§ª ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
      run: |
        echo "ğŸ§ª ãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚ŒãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ†ã‚¹ãƒˆä¸­..."
        
        # ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç–é€šç¢ºèªï¼ˆæœ€å¤§5åˆ†é–“ãƒªãƒˆãƒ©ã‚¤ï¼‰
        for i in {1..30}; do
          if curl -f "$DEPLOYMENT_URL" > /dev/null 2>&1; then
            echo "âœ… ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¾ã—ãŸ: $DEPLOYMENT_URL"
            break
          else
            echo "â³ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•ã‚’å¾…æ©Ÿä¸­... ($i/30)"
            sleep 10
          fi
        done
        
    - name: ğŸ’¬ Slack é€šçŸ¥
      if: always()
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#deployment'
        text: |
          ACI ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ ${{ job.status }}
          Environment: Development
          URL: ${{ env.DEPLOYMENT_URL }}
          Branch: ${{ github.ref }}
          Commit: ${{ github.sha }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

  # æœ¬ç•ªç’°å¢ƒã¸ã®æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤
  deploy-prod:
    name: ğŸ­ æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
    runs-on: ubuntu-latest
    needs: [validate, security-scan]
    if: github.ref == 'refs/heads/main' && github.event_name == 'workflow_dispatch'
    environment: production
    
    steps:
    - name: ğŸ“¥ ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: ğŸ” Azure ãƒ­ã‚°ã‚¤ãƒ³
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
        
    - name: ğŸ“‚ æœ¬ç•ªç’°å¢ƒãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ç¢ºèª
      run: |
        PROD_RG="rg-aci-prod"
        echo "RESOURCE_GROUP=$PROD_RG" >> $GITHUB_ENV
        
        echo "ğŸ“‚ æœ¬ç•ªç’°å¢ƒãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ç¢ºèª: $PROD_RG"
        if ! az group show --name "$PROD_RG" > /dev/null 2>&1; then
          echo "ğŸ“ æœ¬ç•ªç’°å¢ƒãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ: $PROD_RG"
          az group create --name "$PROD_RG" --location "japaneast"
        else
          echo "âœ… æœ¬ç•ªç’°å¢ƒãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™"
        fi
        
    - name: ğŸ” æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ç¢ºèª
      run: |
        TEMPLATE_TYPE="${{ github.event.inputs.template_type || 'aci-with-volumes' }}"
        CONTAINER_NAME="aci-prod"
        
        echo "ğŸ” æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ã® What-If åˆ†æ..."
        
        az deployment group what-if \
          --resource-group "$RESOURCE_GROUP" \
          --template-file "./templates/$TEMPLATE_TYPE/main.bicep" \
          --parameters "./templates/$TEMPLATE_TYPE/main.parameters.json" \
          --parameters containerGroupName="$CONTAINER_NAME" environmentName="production"
          
    - name: ğŸš€ æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤
      run: |
        TEMPLATE_TYPE="${{ github.event.inputs.template_type || 'aci-with-volumes' }}"
        CONTAINER_NAME="aci-prod"
        
        echo "ğŸ­ æœ¬ç•ªç’°å¢ƒã« $TEMPLATE_TYPE ã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ä¸­..."
        
        az deployment group create \
          --resource-group "$RESOURCE_GROUP" \
          --name "aci-prod-deployment-${{ github.run_number }}" \
          --template-file "./templates/$TEMPLATE_TYPE/main.bicep" \
          --parameters "./templates/$TEMPLATE_TYPE/main.parameters.json" \
          --parameters containerGroupName="$CONTAINER_NAME" environmentName="production"
          
    - name: ğŸ“Š æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤çµæœ
      run: |
        echo "ğŸ“Š æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤çµæœã‚’å–å¾—ä¸­..."
        
        DEPLOYMENT_NAME="aci-prod-deployment-${{ github.run_number }}"
        
        FQDN=$(az deployment group show --resource-group "$RESOURCE_GROUP" --name "$DEPLOYMENT_NAME" --query properties.outputs.fqdn.value -o tsv)
        URL=$(az deployment group show --resource-group "$RESOURCE_GROUP" --name "$DEPLOYMENT_NAME" --query properties.outputs.url.value -o tsv)
        
        echo "ğŸ­ æœ¬ç•ªç’°å¢ƒ FQDN: $FQDN"
        echo "ğŸ”— æœ¬ç•ªç’°å¢ƒ URL: $URL"
        
    - name: ğŸ“§ æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤é€šçŸ¥
      if: always()
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        channel: '#production-alerts'
        text: |
          ğŸ­ æœ¬ç•ªç’°å¢ƒ ACI ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ ${{ job.status }}
          Environment: Production
          Template: ${{ github.event.inputs.template_type }}
          Branch: ${{ github.ref }}
          Commit: ${{ github.sha }}
          Deployed by: ${{ github.actor }}
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

  # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
  cleanup-dev:
    name: ğŸ§¹ é–‹ç™ºç’°å¢ƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    runs-on: ubuntu-latest
    needs: [deploy-dev]
    if: always() && github.ref == 'refs/heads/develop'
    
    steps:
    - name: ğŸ” Azure ãƒ­ã‚°ã‚¤ãƒ³
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
        
    - name: ğŸ§¹ å¤ã„ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®å‰Šé™¤
      run: |
        echo "ğŸ§¹ 7æ—¥ä»¥ä¸Šå¤ã„é–‹ç™ºç’°å¢ƒãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤ä¸­..."
        
        # 7æ—¥å‰ã®æ—¥ä»˜ã‚’è¨ˆç®—
        CUTOFF_DATE=$(date -d '7 days ago' +%Y-%m-%d)
        
        # é–‹ç™ºç’°å¢ƒã®ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’æ¤œç´¢ã—ã¦å‰Šé™¤
        az group list --query "[?starts_with(name, 'rg-aci-dev-') && properties.provisioningState == 'Succeeded']" -o tsv --query "[].name" | while read rg_name; do
          # ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ä½œæˆæ—¥ã‚’å–å¾—
          CREATION_DATE=$(az group show --name "$rg_name" --query "tags.createdDate" -o tsv)
          
          if [[ -z "$CREATION_DATE" ]]; then
            # ã‚¿ã‚°ãŒãªã„å ´åˆã¯å‰Šé™¤å¯¾è±¡ã¨ã™ã‚‹
            echo "ğŸ—‘ï¸ ã‚¿ã‚°ã®ãªã„ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤: $rg_name"
            az group delete --name "$rg_name" --yes --no-wait
          elif [[ "$CREATION_DATE" < "$CUTOFF_DATE" ]]; then
            echo "ğŸ—‘ï¸ å¤ã„ãƒªã‚½ãƒ¼ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’å‰Šé™¤: $rg_name (ä½œæˆæ—¥: $CREATION_DATE)"
            az group delete --name "$rg_name" --yes --no-wait
          fi
        done
        
        echo "âœ… ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãŒå®Œäº†ã—ã¾ã—ãŸ"
